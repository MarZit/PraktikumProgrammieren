package guiLager;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;

import application.Specifications;
import javafx.scene.control.Button;
import javafx.scene.layout.GridPane;
import javafx.scene.text.Text;

public class CalendarPane extends GridPane {
	
	Calendar myTodayCalendar = Calendar.getInstance();
	
	public CalendarPane() {
		setUpMonth();
	}
	
	public void setUpMonth() {
		setUpMonthUIHeadline();
		try {
			setUpMonthDays();
		} catch (ParseException e) {
			e.printStackTrace();
		}
	}
	
	private void setUpMonthUIHeadline() {
		String monthStr = myTodayCalendar.getDisplayName(Calendar.MONTH, Calendar.LONG, Specifications.getInstance().getLocale());
		Button monthBackButton = new Button("<");
		Text monthText = new Text(monthStr);
		Button monthForwardButton = new Button(">");
		getChildren().addAll(monthBackButton, monthText, monthForwardButton);
		GridPane.setConstraints(monthBackButton, 0, 0);
		GridPane.setConstraints(monthText, 1, 0);
		GridPane.setColumnSpan(monthText, 5);
		GridPane.setConstraints(monthForwardButton, 6, 0);
	}
	
	private void setUpMonthDays() throws ParseException {
		SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
		Date startDate = formatter.parse(myTodayCalendar.get(Calendar.YEAR) + "-" 
				+ myTodayCalendar.get(Calendar.MONTH) + "-" 
				+ myTodayCalendar.getActualMinimum(Calendar.DAY_OF_MONTH));
		Date endDate = formatter.parse(myTodayCalendar.get(Calendar.YEAR) + "-" 
				+ myTodayCalendar.get(Calendar.MONTH) + "-" 
				+ myTodayCalendar.getActualMaximum(Calendar.DAY_OF_MONTH));
		
		Calendar start = Calendar.getInstance();
		start.setTime(startDate);

		Calendar end = Calendar.getInstance();
		end.setTime(endDate);
		
		int startDayOfWeek = start.get(Calendar.DAY_OF_WEEK) -1;
		System.out.println(startDayOfWeek);
		while( !start.after(end)){
			int dayOfMonth = start.get(Calendar.DAY_OF_MONTH);
			int dayOfWeek = start.get(Calendar.DAY_OF_WEEK) -1;
		    CalendarDay cd = new CalendarDay(dayOfMonth);
		    getChildren().add(cd);
		    GridPane.setConstraints(cd, dayOfWeek, (startDayOfWeek+dayOfMonth)/7 +1);
		    System.out.println(dayOfWeek + "-" + ((startDayOfWeek+dayOfMonth)/7 +1));
		    start.add(Calendar.DATE, 1);
		}
	}
}
